---
title: "ä¸€æ¬¡è„šæœ¬æ‰“åŒ…çš„å®è·µ"
date: 2017/05/22 
categories: å·¥å…·
---

<h3>ä¸šåŠ¡åœºæ™¯</h3>

>&emsp;&emsp;&emsp;&emsp;å°å…¬å¸ï¼Œç»å¸¸è¦æŒ‰éœ€æ±‚æ–¹çˆ¸çˆ¸çš„è¦æ±‚æ¥åšä¸šåŠ¡è°ƒæ•´ï¼Œäºæ˜¯ä¹ç»å¸¸è¢«æµ‹è¯•å¦¹å­å‚¬ç€æ‰“ä¸ªæ–°æµ‹è¯•åŒ…å§ï¼Œæ‰“ä¸ªæ–°æµ‹è¯•åŒ…å§Â·Â·Â·Â· &nbsp;æ€¥åˆ‡çš„æƒ³æ‰¾ä¸€ä¸ªå¯ä»¥å·æ‡’çš„æ–¹å¼æ¥çŸ­æš‚è§£æ”¾è‡ªå·±çš„åŒæ‰‹ä¸ç”¨ä¸€ç›´å®ˆåœ¨ç”µè„‘å‰ç‚¹å•Šç‚¹çš„ã€‚èƒ½å¤Ÿè‡ªåŠ¨æ‰“åŒ…å¹¶å‘é€åˆ°æµ‹è¯•å¦¹å­çš„é‚®ç®±é‡Œå®ç°è¿™æ ·çš„ä¸€æ¡é¾™æœåŠ¡ã€‚è‡ªå·±èƒ½å¤Ÿå·å·çš„ç©ä¼šï¼Œå˜¿å˜¿ğŸ˜œğŸ˜œğŸ˜œğŸ˜œ<!-- more -->

&emsp;&emsp;&emsp;&emsp;~~è‡ªå·±è§„åˆ’çš„éœ€æ±‚å¾ˆç®€å•,æµç¨‹å…±åˆ†ä¸ºä¸¤æ­¥ï¼š**ç¬¬ä¸€æ­¥ï¼Œè„šæœ¬è‡ªåŠ¨æ‰“åŒ…ï¼Œç¬¬äºŒæ­¥ï¼Œå°†ipa.zipå‘é€åˆ°xç›¸å…³äººå‘˜çš„é‚®ç®±**~~

&emsp;&emsp;&emsp;&emsp;æµç¨‹å…±åˆ†ä¸ºä¸‰æ­¥ï¼š**ç¬¬ä¸€æ­¥ï¼Œè„šæœ¬è‡ªåŠ¨æ‰“åŒ…ï¼Œç¬¬äºŒæ­¥ï¼Œå°†ipa.zipå‘é€åˆ°xç›¸å…³äººå‘˜çš„é‚®ç®±ã€‚ç¬¬ä¸‰æ­¥ï¼šipaåŒ…ä¸Šä¼ App Store**

&emsp;&emsp;&emsp;&emsp;ä¹‹å‰åœ¨åšè‡ªåŠ¨åŒ–æµ‹è¯•æ—¶å€™ä¹Ÿæ›¾ç»æ¶‰çŒè¿‡è„šæœ¬æ‰“åŒ…çš„ä¸šåŠ¡ï¼Œå½“æ—¶æ˜¯åœ¨Jenkinç¯å¢ƒä¸‹å®ç°è¯¥ä¸šåŠ¡çš„([Jenkins æ‰“åŒ… iOS](http://www.jianshu.com/p/047ac4c39297))ã€‚å½“æ—¶éœ€æ±‚å¾ˆç®€å•ä¹Ÿæ˜¯é¢„ç ”æ€§è´¨çš„ä¸œè¥¿ï¼Œåªä¸ºèƒ½å®ç°è„šæœ¬æ‰“åŒ…ã€‚æ‰€ä»¥è„šæœ¬å®ç°æ–¹å¼æ¯”ç²—çŠ·ï¼Œç°åœ¨çœ‹æ¥å·²ç»ä¸èƒ½å¾ˆå®Œç¾çš„é€‚åº”ç°åœ¨çš„è¦æ±‚ï¼Œæˆ‘éœ€è¦ä¸€ç§æ›´æ™ºèƒ½æ›´ä¼˜é›…çš„å®ç°æ–¹å¼ã€‚ç»è¿‡ä¸€æ®µæ—¶é—´çš„èµ„æ–™æŸ¥æ‰¾,å¹¶æ²¡æœ‰æ‰¾åˆ°ä¸€ä¸ªå¾ˆå¥½çš„è§£å†³æ–¹æ¡ˆã€‚åæ¥æœ‹å‹æ¨è[jkpang-åº](https://github.com/jkpang)å†™çš„ä¸€ä¸ªæ‰“åŒ…è„šæœ¬[PPAutoPackageScript](https://github.com/jkpang/PPAutoPackageScript)æä¾›äº†å¾ˆå¥½çš„è§£å†³æ–¹æ¡ˆæ¨¡å‹ï¼Œäºæ˜¯å°±æ¬ä¸çŸ¥è€»çš„æŒ‰è‡ªå·±çš„éœ€æ±‚æ‚„æ‚„æ”¹ä»£ç äº†ã€‚


<h3>è„šæœ¬æ‰“åŒ…</h3>

&emsp;&emsp;&emsp;&emsp;è„šæœ¬æ˜¯ä½¿ç”¨åˆ«äººçš„ï¼Œå‰äººæ ½æ ‘åäººä¹˜å‡‰ã€‚æˆ‘æ ¹æ®å®é™…éœ€è¦å°†åŸè„šæœ¬ä¸­çš„ä¸€äº›å›ºå®šå‚æ•°æ”¹æˆæ‰‹åŠ¨é€‰æ‹©è¾“å…¥çš„æ¨¡å¼ï¼Œåœ¨è¿™é‡Œä¸åšä¸€ä¸€è¯¦ç»†è®²è§£ã€‚

<h3>å°†ipa.zipå‘é€åˆ°ç›¸å…³äººå‘˜çš„é‚®ç®±</h3>

æ¥ä¸‹æ¥å°±æ˜¯å‘é€ipaåˆ°æŒ‡å®šé‚®ç®±ã€‚åœ¨å®ç°è¿‡ç¨‹ä¸­è¦è§£å†³å¦‚ä¸‹ä¸¤ä¸ªé—®é¢˜ï¼š

 - æ¯æ¬¡ä¸Šä¼ å‘é‚®ä»¶éƒ½è¦è¾“å…¥å¯†ç 
 ```
 #æŸ¥é˜…èµ„æ–™åä½¿ç”¨è¯¥æ–¹æ³• echo <123> | sudo -S <command>
 ```
 
 - å‘é‚®ä»¶æ—¶ä¿®æ”¹ä¸Šä¼ å¤§æ–‡ä»¶é™åˆ¶
 ```
 # ä¿®æ”¹å¤§æ–‡ä»¶é™åˆ¶ echo $macPassowrd | sudo -S postconf -e message_size_limit=0
postconf -d | grep size
```

<h3>æ‰“åŒ…ipaä¸Šä¼ App Store</h3>

&emsp;&emsp;&emsp;&emsp;æ—¢ç„¶è„šæœ¬æ‰“åŒ…å¹¶å‘é€é‚®ä»¶éƒ½åšæˆäº†ï¼Œæˆ‘æ˜¯ä¸æ˜¯å¯ä»¥æ›´æ‡’ç‚¹ï¼Ÿä¸Šçº¿æ—¶å€™æ˜¯ä¸æ˜¯ä¹Ÿå¯ä»¥é€šè¿‡è„šæœ¬æ¥å®Œæˆï¼Ÿèƒ½å¤Ÿç•™å‡ºæ›´å¤šæ—¶é—´releaxä¸€ä¸‹ï¼Ÿç­”æ¡ˆç»å¯¹æ˜¯å¯ä»¥çš„ï¼ å…¶å®å¯¹äºå‘½ä»¤è¡Œä¸Šä¼ App Storeæˆ‘ä¹Ÿè§‰å¾—æ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œå…¶ä¸€æ˜¯å› ä¸ºåœ¨appleå®˜ç½‘ä¸Šç›´æ¥ç»™å‡º[altoolå‘½ä»¤](http://help.apple.com/itc/apploader/#/apdATD1E53-D1E1A1303-D1E53A1126)å¼€å‘è€…åªè¦éµå¾ªè§„åˆ™å»å¡«å……å°±å¥½ã€‚å…¶æ¬¡æ˜¯å› ä¸ºåœ¨å®é™…å¼€å‘è¿‡ç¨‹ä¸­æˆ‘ä»¬å¤§å¤šæ•°äººä½¿ç”¨å…¶çš„é¢‘ç‡å®åœ¨ç®—ä¸ä¸Šé«˜ã€‚å¤§å®¶æ›´å¤šæƒ…å†µä¸‹è¿˜æ˜¯ä¼šä½¿ç”¨Xcodeç›´æ¥ä¸Šä¼ æˆ–è€…æ˜¯é€šè¿‡Application Loaderæ¥ä¸Šä¼ ï¼Œå¹¶ä¸ä¼šé€‰æ‹©çš„å»ä½¿ç”¨å‘½ä»¤è¡Œæ¥å®ç°ä¸Šä¼ ä»»åŠ¡ã€‚ç„¶è€Œï¼Œæˆ‘ä¸å–œæ¬¢é™é™å®ˆåœ¨æœºå™¨å‰çœ‹è¿›åº¦æ¡ï¼Œäºæ˜¯æˆ‘åšäº†å¦‚ä¸‹æµç¨‹æµ‹è¯•ï¼š

- ä½¿ç”¨è„šæœ¬éªŒè¯
```
altool --validate-app -f file -u username [-p password] [--output-format xml]
```
- è„šæœ¬ä¸Šä¼ ipa
```
altool --upload-app -f file -u username [-p password] [--output-format xml]
```
- æ•è·è¾“å‡ºæ—¥å¿—ï¼Œæ ¹æ®æ—¥å¿—å†…å®¹åˆ¤æ–­ä¸Šä¼ ç»“æœã€‚

```
if [[ "$result" != "" ]]
 then
     echo "ä¸Šä¼ åˆ°App StoreæˆåŠŸ"
     # ä¸Šä¼ æˆåŠŸï¼Œé€šçŸ¥å¼€å‘äººå‘˜
 else
     echo "ä¸Šä¼ åˆ°App StoreæˆåŠŸå¤±è´¥"
     # ä¿ç•™xmlä»¥å¤‡æŸ¥è¯¢
 fi

 ```
 
å®é™…æµ‹è¯•è¿‡ç¨‹ä¸­ç¬”è€…å¾—åˆ°å¦‚ä¸‹æ ¼å¼çš„æˆåŠŸå’Œå¤±è´¥ä¸¤ä»½xmlæ–‡æ¡£ï¼Œè¯»è€…åœ¨æ“ä½œæ—¶å€™è‡ªè¡Œé€‰æ‹©æ˜¯å¦å‚è€ƒ


 ```
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
	<key>dev-tools-info</key>
	<dict>
		<key>platforms</key>
		<dict>
			<key>iPhoneOS.platform</key>
			<dict>
				<key>paths</key>
				<array>
					<string>/Applications/Xcode.app/Contents/Developer/Platforms/iPhoneOS.platform/usr/bin</string>
					<string>/Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin</string>
					<string>/Applications/Xcode.app/Contents/Developer/usr/bin</string>
					<string>/usr/local/bin</string>
					<string>/usr/bin</string>
					<string>/Users/Master/.rbenv/shims</string>
					<string>/bin</string>
					<string>/usr/sbin</string>
					<string>/sbin</string>
					<string>/Applications/Xcode.app/Contents/Applications/Application Loader.app/Contents/Frameworks/ITunesSoftwareService.framework/Resources</string>
				</array>
			</dict>
		</dict>
		<key>search-method</key>
		<integer>1</integer>
		<key>search-method-string</key>
		<string>Enclosing Xcode</string>
		<key>xcode-info</key>
		<dict>
			<key>path</key>
			<string>/Applications/Xcode.app/Contents/Developer</string>
			<key>version.plist</key>
			<dict>
				<key>BuildVersion</key>
				<string>4</string>
				<key>CFBundleShortVersionString</key>
				<string>8.3.2</string>
				<key>CFBundleVersion</key>
				<string>12175</string>
				<key>ProductBuildVersion</key>
				<string>8E2002</string>
				<key>ProjectName</key>
				<string>IDEFrameworks</string>
				<key>SourceVersion</key>
				<string>12175000000000000</string>
			</dict>
		</dict>
	</dict>
	<key>os-version</key>
	<string>10.12.5</string>
	<key>product-errors</key>
	<array>
		<dict>
			<key>code</key>
			<integer>-18000</integer>
			<key>message</key>
			<string>ERROR ITMS-4238: "Redundant Binary Upload. There already exists a binary upload with build version '1.3' for train '1.3'" at SoftwareAssets/PreReleaseSoftwareAsset</string>
			<key>userInfo</key>
			<dict>
				<key>NSLocalizedDescription</key>
				<string>ERROR ITMS-4238: "Redundant Binary Upload. There already exists a binary upload with build version '1.3' for train '1.3'" at SoftwareAssets/PreReleaseSoftwareAsset</string>
				<key>NSLocalizedFailureReason</key>
				<string>ERROR ITMS-4238: "Redundant Binary Upload. There already exists a binary upload with build version '1.3' for train '1.3'" at SoftwareAssets/PreReleaseSoftwareAsset</string>
				<key>NSLocalizedRecoverySuggestion</key>
				<string>ERROR ITMS-4238: "Redundant Binary Upload. There already exists a binary upload with build version '1.3' for train '1.3'" at SoftwareAssets/PreReleaseSoftwareAsset</string>
			</dict>
		</dict>
	</array>
	<key>tool-path</key>
	<string>/Applications/Xcode.app/Contents/Applications/Application Loader.app/Contents/Frameworks/ITunesSoftwareService.framework</string>
	<key>tool-version</key>
	<string>1.9.784</string>
</dict>
</plist>
```
<center>ä»¥ä¸Šä¸ºå¤±è´¥æ ·å¼</center>

```
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
    <key>os-version</key>
    <string>10.11.2</string>
    <key>success-message</key>
    <string>No errors validating archive at /XXX/XXX.ipa</string>
    <key>tool-version</key>
    <string>1.1.902</string>
    <key>xcode-versions</key>
    <array>
        <dict>
            <key>path</key>
            <string>/Applications/Xcode.app</string>
            <key>version.plist</key>
            <dict>
                <key>BuildVersion</key>
                <string>7</string>
                <key>CFBundleShortVersionString</key>
                <string>7.2</string>
                <key>CFBundleVersion</key>
                <string>9548</string>
                <key>ProductBuildVersion</key>
                <string>7C68</string>
                <key>ProjectName</key>
                <string>IDEFrameworks</string>
                <key>SourceVersion</key>
                <string>9548000000000000</string>
            </dict>
        </dict>
    </array>
</dict>
</plist>

```
ä»¥ä¸Šä¸ºæˆåŠŸæ ·å¼(å½“æ—¶æ²¡æ‹·è´æ–‡ä»¶ç°åœ¨æ‰¾çš„ä¸€ä»½[åˆ«äººçš„](http://zackzheng.info/2015/12/27/2015-12-27-an-automated-script-for-building-archiving-submission-sending-emails/))

æœ€åé™„ä¸Šæµ‹è¯•æ—¶ä½¿ç”¨çš„è„šæœ¬

```
#App Storeè´¦å·å’Œå¯†ç 
username=""
password=""

altoolPath="/Applications/Xcode.app/Contents/Applications/Application Loader.app/Contents/Frameworks/ITunesSoftwareService.framework/Versions/A/Support/altool"

# # æ£€éªŒåŒ…å†…å®¹$ altool

echo "éªŒè¯ipaåŒ…å¼€å§‹"

$("${altoolPath}" --validate-app -f "UsedCars-v1.3.ipa" -u $username [-p $password] [--output-format xml]) > result.xml
# # ä¸Šä¼ è„šæœ¬
"${altoolPath}" --upload-app -f "UsedCars-v1.3.ipa" -u $username -p $password -t ios --output-format xml

FILE=$(cat result.xml)
#echo $FILE
#æˆåŠŸä¸Šä¼ ååŒ…å«å­—ç¬¦
PATTERN="success-message"
result=$(echo $FILE | grep "${PATTERN}")
 if [[ "$result" != "" ]]
 then
     echo "ä¸Šä¼ åˆ°App StoreæˆåŠŸ"
     # ä¸Šä¼ æˆåŠŸï¼Œé€šçŸ¥å¼€å‘äººå‘˜
 else
     echo "ä¸Šä¼ åˆ°App StoreæˆåŠŸå¤±è´¥"
     # ä¿ç•™xmlä»¥å¤‡æŸ¥è¯¢
 fi

```
ç»è¿‡ä¸æ–­çš„ä¼˜åŒ–ä¸è°ƒæ•´åï¼Œæœ€ç»ˆå®Œæ•´ä»£ç å¦‚ä¸‹ï¼š

```
# ===============================é¡¹ç›®è‡ªå®šä¹‰éƒ¨åˆ†(è‡ªå®šä¹‰å¥½ä¸‹åˆ—å‚æ•°åå†æ‰§è¡Œè¯¥è„šæœ¬)============================= #
# è®¡æ—¶
SECONDS=0
# æ˜¯å¦ç¼–è¯‘å·¥ä½œç©ºé—´ (ä¾‹:è‹¥æ˜¯ç”¨Cocopodsç®¡ç†çš„.xcworkspaceé¡¹ç›®,èµ‹å€¼true;ç”¨Xcodeé»˜è®¤åˆ›å»ºçš„.xcodeproj,èµ‹å€¼false)

echo "\033[36;1mè¯·é€‰æ‹©ç¼–è¯‘å·¥ä½œç©ºé—´æ–¹å¼(è¾“å…¥åºå·,æŒ‰å›è½¦å³å¯) \033[0m"
echo "\033[33;1m1. Cocopodsç®¡ç†åºå·ä¸º1       \033[0m"
echo "\033[33;1m2. Xcodeé»˜è®¤åˆ›å»ºåºå·ä¸º2    \033[0m"

read archiveType
is_workspace="false"
if [ -n "$archiveType" ]
then
    if  [ "$archiveType" = "1" ] ; then
     is_workspace="true"
     elif  [ "$archiveType" = "2" ] ; then
     is_workspace="false"
     else
     echo "è¾“å…¥çš„å‚æ•°æ— æ•ˆ!!!"
     exit  1
     fi    
fi
# echo $is_workspace

# æŒ‡å®šé¡¹ç›®çš„schemeåç§°
# (æ³¨æ„: å› ä¸ºshellå®šä¹‰å˜é‡æ—¶,=å·ä¸¤è¾¹ä¸èƒ½ç•™ç©ºæ ¼,è‹¥scheme_nameä¸info_plist_nameæœ‰ç©ºæ ¼,è„šæœ¬è¿è¡Œä¼šå¤±è´¥,æš‚æ—¶è¿˜æ²¡æœ‰è§£å†³æ–¹æ³•,çŸ¥é“çš„è¿˜è¯·æŒ‡æ•™!)
echo "\033[36;1mè¯·è¾“å…¥å·¥ç¨‹å(å·¦ä¸Šè§’scheme)ï¼š\033[0m"
read scheme
# sleep 0.5
scheme_name="$scheme"
# echo $scheme_name
# å·¥ç¨‹ä¸­Targetå¯¹åº”çš„é…ç½®plistæ–‡ä»¶åç§°, Xcodeé»˜è®¤çš„é…ç½®æ–‡ä»¶ä¸ºInfo.plist
info_plist_name="Info"
# æŒ‡å®šè¦æ‰“åŒ…ç¼–è¯‘çš„æ–¹å¼ : Release,Debug...
echo "\033[36;1mè¯·é€‰æ‹©æ‰“åŒ…ç¼–è¯‘æ–¹å¼(è¾“å…¥åºå·,æŒ‰å›è½¦å³å¯) \033[0m"
echo "\033[33;1m1. Debugåºå·ä¸º1       \033[0m"
echo "\033[33;1m2. Releaseåºå·ä¸º2    \033[0m"

read  configurationType
build_configuration="Debug"
if [ -n "$configurationType" ]
then
    if  [ "$configurationType" = "1" ] ; then
     build_configuration="Debug"
     elif  [ "$configurationType" = "2" ] ; then
     build_configuration="Release"
     else
     echo "è¾“å…¥çš„å‚æ•°æ— æ•ˆ!!!"
     exit  1
     fi    
fi

# ===============================è‡ªåŠ¨æ‰“åŒ…éƒ¨åˆ†(æ— ç‰¹æ®Šæƒ…å†µä¸ç”¨ä¿®æ”¹)============================= #

# å¯¼å‡ºipaæ‰€éœ€è¦çš„plistæ–‡ä»¶è·¯å¾„ (é»˜è®¤ä¸ºAdHocExportOptionsPlist.plist)
ExportOptionsPlistPath="./PPAutoPackageScript/AdHocExportOptionsPlist.plist"
# è¿”å›ä¸Šä¸€çº§ç›®å½•,è¿›å…¥é¡¹ç›®å·¥ç¨‹ç›®å½•
cd ..
# è·å–é¡¹ç›®åç§°
project_name=`find . -name *.xcodeproj | awk -F "[/.]" '{print $(NF-1)}'`
# è·å–ç‰ˆæœ¬å·,å†…éƒ¨ç‰ˆæœ¬å·,bundleID
info_plist_path="$project_name/$info_plist_name.plist"
bundle_version=`/usr/libexec/PlistBuddy -c "Print CFBundleShortVersionString" $info_plist_path`
bundle_build_version=`/usr/libexec/PlistBuddy -c "Print CFBundleIdentifier" $info_plist_path`
bundle_identifier=`/usr/libexec/PlistBuddy -c "Print CFBundleVersion" $info_plist_path`

# åˆ é™¤æ—§.xcarchiveæ–‡ä»¶
rm -rf ~/Desktop/$scheme_name-IPA/$scheme_name.xcarchive
# æŒ‡å®šè¾“å‡ºipaè·¯å¾„
export_path=~/Desktop/$scheme_name-IPA
# æŒ‡å®šè¾“å‡ºå½’æ¡£æ–‡ä»¶åœ°å€
export_archive_path="$export_path/$scheme_name.xcarchive"
# æŒ‡å®šè¾“å‡ºipaåœ°å€
export_ipa_path="$export_path"
# æŒ‡å®šè¾“å‡ºipaåç§° : scheme_name + bundle_version
ipa_name="$scheme_name-v$bundle_version"

# AdHoc,AppStore,Enterpriseä¸‰ç§æ‰“åŒ…æ–¹å¼çš„åŒºåˆ«: http://blog.csdn.net/lwjok2007/article/details/46379945
echo "\033[36;1mè¯·é€‰æ‹©æ‰“åŒ…æ–¹å¼(è¾“å…¥åºå·,æŒ‰å›è½¦å³å¯) \033[0m"
echo "\033[33;1m1. AdHoc       \033[0m"
echo "\033[33;1m2. AppStore    \033[0m"
echo "\033[33;1m3. Enterprise  \033[0m"
echo "\033[33;1m4. Development \033[0m"
# è¯»å–ç”¨æˆ·è¾“å…¥å¹¶å­˜åˆ°å˜é‡é‡Œ
read parameter
sleep 0.5
method="$parameter"

# åˆ¤è¯»ç”¨æˆ·æ˜¯å¦æœ‰è¾“å…¥
if [ -n "$method" ]
then
    if [ "$method" = "1" ] ; then
    ExportOptionsPlistPath="./PPAutoPackageScript/AdHocExportOptionsPlist.plist"
    elif [ "$method" = "2" ] ; then
    ExportOptionsPlistPath="./PPAutoPackageScript/AppStoreExportOptionsPlist.plist"
    elif [ "$method" = "3" ] ; then
    ExportOptionsPlistPath="./PPAutoPackageScript/EnterpriseExportOptionsPlist.plist"
    elif [ "$method" = "4" ] ; then
    ExportOptionsPlistPath="./PPAutoPackageScript/DevelopmentExportOptionsPlist.plist"
    else
    echo "è¾“å…¥çš„å‚æ•°æ— æ•ˆ!!!"
    exit 1
    fi
fi
echo "\033[36;1mè¯·è¾“å…¥æœ¬æœºå¯†ç (è¾“å…¥å¯†ç ,æŒ‰å›è½¦å³å¯) \033[0m"
read macPassowrd
echo "\033[32m*************************  å¼€å§‹æ„å»ºé¡¹ç›®  *************************  \033[0m"
# æŒ‡å®šè¾“å‡ºæ–‡ä»¶ç›®å½•ä¸å­˜åœ¨åˆ™åˆ›å»º
if [ -d "$export_path" ] ; then
echo $export_path
else
mkdir -pv $export_path
fi

# åˆ¤æ–­ç¼–è¯‘çš„é¡¹ç›®ç±»å‹æ˜¯workspaceè¿˜æ˜¯project
if $is_workspace ; then
# ç¼–è¯‘å‰æ¸…ç†å·¥ç¨‹
xcodebuild clean -workspace ${project_name}.xcworkspace \
                 -scheme ${scheme_name} \
                 -configuration ${build_configuration}

xcodebuild archive -workspace ${project_name}.xcworkspace \
                   -scheme ${scheme_name} \
                   -configuration ${build_configuration} \
                   -archivePath ${export_archive_path}
else
# ç¼–è¯‘å‰æ¸…ç†å·¥ç¨‹
xcodebuild clean -project ${project_name}.xcodeproj \
                 -scheme ${scheme_name} \
                 -configuration ${build_configuration}

xcodebuild archive -project ${project_name}.xcodeproj \
                   -scheme ${scheme_name} \
                   -configuration ${build_configuration} \
                   -archivePath ${export_archive_path}
fi

#  æ£€æŸ¥æ˜¯å¦æ„å»ºæˆåŠŸ
#  xcarchive å®é™…æ˜¯ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸æ˜¯ä¸€ä¸ªæ–‡ä»¶æ‰€ä»¥ä½¿ç”¨ -d åˆ¤æ–­
if [ -d "$export_archive_path" ] ; then
echo "\033[32;1mé¡¹ç›®æ„å»ºæˆåŠŸ ğŸš€ ğŸš€ ğŸš€  \033[0m"
else
echo "\033[31;1mé¡¹ç›®æ„å»ºå¤±è´¥ ğŸ˜¢ ğŸ˜¢ ğŸ˜¢  \033[0m"
exit 1
fi

echo "\033[32m*************************  å¼€å§‹å¯¼å‡ºipaæ–‡ä»¶  *************************  \033[0m"
xcodebuild  -exportArchive \
            -archivePath ${export_archive_path} \
            -exportPath ${export_ipa_path} \
            -exportOptionsPlist ${ExportOptionsPlistPath}
# ä¿®æ”¹ipaæ–‡ä»¶åç§°
mv $export_ipa_path/$scheme_name.ipa $export_ipa_path/$ipa_name.ipa

# æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
if [ -f "$export_ipa_path/$ipa_name.ipa" ] ; then
echo "\033[32;1må¯¼å‡º ${ipa_name}.ipa åŒ…æˆåŠŸ ğŸ‰  ğŸ‰  ğŸ‰   \033[0m"
# open $export_path
else
echo "\033[31;1må¯¼å‡º ${ipa_name}.ipa åŒ…å¤±è´¥ ğŸ˜¢ ğŸ˜¢ ğŸ˜¢     \033[0m"
# ç›¸å…³çš„è§£å†³æ–¹æ³•
echo "\033[34mps:ä»¥ä¸‹ç±»å‹çš„é”™è¯¯å¯ä»¥å‚è€ƒå¯¹åº”çš„é“¾æ¥\033[0m"
echo "\033[34m  1.\"error: exportArchive: No applicable devices found.\" --> å¯èƒ½æ˜¯rubyç‰ˆæœ¬è¿‡ä½å¯¼è‡´,å‡çº§æœ€æ–°ç‰ˆrubyå†è¯•,å‡çº§æ–¹æ³•è‡ªè¡Œç™¾åº¦/è°·æ­Œ,GitHub issue: https://github.com/jkpang/PPAutoPackageScript/issues/1#issuecomment-297589697"
echo "\033[34m  2.\"No valid iOS Distribution signing identities belonging to team 6F4Q87T7VD were found.\" --> http://fight4j.github.io/2016/11/21/xcodebuild/ \033[0m"
exit 1
fi
# è¾“å‡ºæ‰“åŒ…æ€»ç”¨æ—¶
echo "\033[36;1mä½¿ç”¨PPAutoPackageScriptæ‰“åŒ…æ€»ç”¨æ—¶: ${SECONDS}s \033[0m"
# å‘é€é‚®ä»¶ç»™åŒäº‹
cd  $export_path
zipName="tempZipName.zip"
zip -r $zipName $export_ipa_path/$ipa_name.ipa
export LANG=C.UTF-8
#$echo <123> | sudo -S <command>
# ä¿®æ”¹å¤§æ–‡ä»¶é™åˆ¶
echo $macPassowrd | sudo -S postconf -e message_size_limit=0
postconf -d | grep size
# echo message_size_limit
# å‹ç¼©åŒ…è·¯å¾„
zipPath=$export_path/$zipName
# é‚®ä»¶æ ‡é¢˜ï¼ˆä½¿ç”¨UTF8ç¼–ç ï¼‰
emailTitle="æ–°ç‰ˆæµ‹è¯•åŒ…"
emailBody="æ–°ç‰ˆæµ‹è¯•åŒ…ï¼Œæœ‰ä»»ä½•é—®é¢˜è¯·åŠæ—¶ä¸æˆ‘è”ç³»"
( echo $emailBody; uuencode $zipPath ipa.zip) | mail -s $emailTitle xyhuangjia@yeah.net
echo "\033[36;1må‘é€é‚®ä»¶æˆåŠŸ \033[0m"

```
**æ³¨ï¼š**å¦‚æœ‰ä»»ä½•ç–‘é—®è¯·å‘é‚®ä»¶åˆ°xyhuangjia@yeah.netè”ç³»æˆ‘
